<!-- templates/imovel_form.html -->
{% extends "base.html" %}

{% block content %}
  {% if acao == "criar" %}
    <h2>Novo Imóvel</h2>
    <form action="{{ url_for('imovel_criar') }}" method="POST">
  {% else %}
    <h2>Editar Imóvel</h2>
    <form action="{{ url_for('imovel_atualizar', id=imovel.id) }}" method="POST">
  {% endif %}

    <label for="titulo">Título *</label>
    <input type="text" id="titulo" name="titulo" required
           value="{{ imovel.titulo or '' }}" />

    <label for="descricao">Descrição *</label>
    <textarea id="descricao" name="descricao" rows="3" required>{{ imovel.descricao or '' }}</textarea>

    <label for="endereco">Endereço (Rua, Número, Bairro) *</label>
    <input type="text" id="endereco" name="endereco" required
           value="{{ imovel.endereco or '' }}" />

    <div style="display: flex; gap: 12px;">
      <div style="flex:1">
        <label for="cidade">Cidade *</label>
        <input type="text" id="cidade" name="cidade" required
               value="{{ imovel.cidade or '' }}" />
      </div>
      <div style="flex:1">
        <label for="estado">Estado *</label>
        <input type="text" id="estado" name="estado" required
               value="{{ imovel.estado or '' }}" />
      </div>
    </div>

    <label for="cep">CEP *</label>
    <input type="text" id="cep" name="cep" required
           value="{{ imovel.cep or '' }}" />

    <label for="tipo_imovel">Tipo de Imóvel *</label>
    <select id="tipo_imovel" name="tipo_imovel" required>
      <option value="">-- selecione --</option>
      <option value="Apartamento" {% if imovel.tipo_imovel=='Apartamento' %}selected{% endif %}>Apartamento</option>
      <option value="Casa" {% if imovel.tipo_imovel=='Casa' %}selected{% endif %}>Casa</option>
      <option value="Flat" {% if imovel.tipo_imovel=='Flat' %}selected{% endif %}>Flat</option>
    </select>

    <div style="display: flex; gap: 12px;">
      <div style="flex:1">
        <label for="num_quartos">Quartos *</label>
        <input type="number" id="num_quartos" name="num_quartos" min="1" required
               value="{{ imovel.num_quartos or '' }}" />
      </div>
      <div style="flex:1">
        <label for="num_banheiros">Banheiros *</label>
        <input type="number" id="num_banheiros" name="num_banheiros" min="1" required
               value="{{ imovel.num_banheiros or '' }}" />
      </div>
      <div style="flex:1">
        <label for="num_vagas">Vagas (opcional)</label>
        <input type="number" id="num_vagas" name="num_vagas" min="0"
               value="{{ imovel.num_vagas or '0' }}" />
      </div>
    </div>

    <label for="acomoda">Acomodações (nº de hóspedes) *</label>
    <input type="number" id="acomoda" name="acomoda" min="1" required
           value="{{ imovel.acomoda_hospedes or '' }}" />

    <label for="preco">Preço por Noite (R$) *</label>
    <input type="number" id="preco" name="preco" step="0.01" min="1" required
           value="{{ imovel.preco_noite or '' }}" />

    <label for="proprietario_id">Proprietário *</label>
    {% if acao == "criar" %}
      <select id="proprietario_id" name="proprietario_id" required>
        <option value="">-- selecione --</option>
        {% for p in proprietarios %}
          <option value="{{ p.id }}" {% if imovel.proprietario_id == p.id %}selected{% endif %}>
            {{ p.nome }} ({{ p.email }})
          </option>
        {% endfor %}
      </select>
    {% else %}
      <!-- Ao editar, não permitimos mudar o proprietário -->
      {% set prop = (usuarios | selectattr("id", "equalto", imovel.proprietario_id) | list) %}
      <input type="text" value="{{ prop[0].nome if prop else imovel.proprietario_id }}" readonly
             style="background:#f0f0f0;" />
    {% endif %}

    <div class="actions">
      <button type="submit" class="btn">
        {% if acao == "criar" %}Cadastrar{% else %}Atualizar{% endif %}
      </button>
      <a href="{{ url_for('imoveis_list') }}" class="btn btn-danger" style="margin-left:8px;">
        Cancelar
      </a>
    </div>
  </form>
{% endblock %}
